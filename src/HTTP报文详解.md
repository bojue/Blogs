# HTTP报文详解
[HTTP报文详解](#http报文详解)   
- [报文流](#报文流)        
- [报文组成](#报文组成)    
- [报文语法](#报文语法)
- [方法](#方法)     
- [状态码](#状态码)
- [原因短语](#原因短语)
- [参考](#参考)

HTTP是超文本传输协议（HyperText Transfer Protocol），处在网络四层架构的应用层。

HTTP报文由简单字符串组成的文本，HTTP报文是对HTPP请求的额外描述，方便客户端和服务器解析，开发者可以通过报文快速获取当前状态信息，报文分为请求报文和相应报文。

#### 报文流

报文是流动在客户端和服务器之间的数据块，数据块以文本形式的元信息开头，这些信息对报文内容和含义的描述。

报文使用流入和流出表示报文的方向，发起端作为报文的上流，相应端作为报文的下游。报文总是从发起端流入相应端。在请求发起阶段客户端是报文的发起端，在请求相应阶段客户端作为报文的相应端。

#### 报文组成

一个完整的报文由起始行，首部，可选的报文主体3部分组成：

![HTTP首部](https://github.com/bojue/Blogs/blob/master/assets/http_header.png)

- 起始行

报文分为请求报文和相应报文，起始报文是报文的第一行字符串，起始报文说明报文要处理的内容，相应报文返回服务器发生了什么。

- 首部字段

完整的报文包含0个或者多个分行的ASCII文本首部字段组成，为了方便服务器解析，首部字段由:隔开的键和值两部分组成，首部以一个空行结束。首部字段可以为空。

- 报文主体

 报文主体和首部用空行隔开，报文主体是服务器相应的资源，可以是任何形式的数据，包括字符串，html等文本形式，也可以是二进制形式，文本形式可以为空，比如HTTP协议的[OPTIONS](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/OPTIONS)方法就是一个返回主体为空的请求。

#### 报文语法

报文根据请求报文和相应报文存在不同的报文语法，每个括号词汇所表示的是一个独立的报文组件。

* 请求报文

        <method><request-URL><version>
        <headers>
        <entrty-body>
* 相应报文

        <version><satatus><reaspon-pharse>
        <headers>
        <entrty-body>

| 报文组件 | 名称 | 描述 |
|-----|-----|-----|
| method | 方法| 客户端发起的请求方式，比如GET,PUT,POST,DELETE|
| request-URL | 请求URL |请求资源的绝对路径|
| version | HTTP 版本 | 常见的版本：HTTP1.0, HTTP1.1,HTTP2.0 |
| status | 状体码 | 服务器相应的状体码，用3位数字描述的请求结果，常见的200表示请求成功，404未找到资源，304本地缓存 |
| reason-pharse | 原因短语 | 描述status的原因文本，对开发者提供的可读性友好的请求状体描述 |
| headers | 首部 | 包含0个或者多个首部，与主体使用空格隔开，HTTP0.9版本不包含首部，HTTP1.1版本有效请求和相应必须包含特定的首部 |
| entity-body | 实体主体部分 | 任意格式的数据组成，不是必须的 |

#### 方法

HTTP 请求报文起始行以方法开头，方法用来告诉服务器要做什么操作。

| 方法名称 | 描述 | 
|-----|-----|
| GET | 请求指定资源，仅可以用来获取资源 |
| HEAD | 和GET相同，只包含响应首部，没有响应主体 |
| POST | 提交指定的资源，导致服务器状态发生变化 |
| PUT | 提交指定之言，取代服务器现有资源 |
| DELETE | 删除指定资源资源，特殊资源删除操作之前，一般会有权限验证前一步操作 |
| OPTIONS | 获取目的资源所支持的通信选项， 可以支持一个特定URL，也可以支持整个网站 | 
| CONNECT | 建立一个到由目标资源标识的服务器的隧道 |
| PATCH | 方法用于对资源应用部分修改 |
| TRACE | 沿着到目标资源的路径执行一个消息环回测试 | 

HTTP支持方法的扩展，可以根据HTTP规范扩展适用自己的额外的自定义方法，一般很少用到。

#### 状态码

状态码存在响应报文返回客户端，由3位数字组成，方便处理服务器响应状态，数字状态码一般伴随文字表述短语存在。

目前已经分配的状态码：

| 整体范围 | 已定义 | 描述 |
|----|----|----|
|100 ~ 199|100 ~ 101| 信息提示 |
|200 ~ 299|200 ~ 206| 成功 |
|300 ~ 399|300 ~ 315| 重定向 |
|400 ~ 499|400 ~ 415| 客户端错误 |
|500 ~ 599|500 ~ 505| 服务器错误 | 

状态码摘取（[CMD: HTTP响应状态](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status)）：

|状态码| 描述|
|----|----|
| 100 | 连接正常，客户端可以正常请求，请求完毕则忽略。|
| 101 | 服务器正在响应客户端Upgrade请求头，进行协议切换。|
| 200 | 响应成功。|
| 201 | 资源创建成功，比如使用POST方法成功创建新的对象并返回响应。|
| 202 | 服务器接收到请求，但是尚未处理，处理结果未知。|
| 203 | 请求被成功响应，获取的负载资源被代理服务器修改。|
| 204 | 成功状态，但是客户端不需要更新页面，204响应结果可以通过配置响应首部ETag进行缓存。|
| 206 | 通知客户端重置文档视图，比如刷新页面，重置表单。|
| 300 | 重定向响应，标示又多种可能响应，服务器可能通过提供Location首部，提供优先选择。|
| 301 | 永远重定向，由Location首部字段指定永远重定向URL，搜索引擎会根据响应更新。|
| 302 | 暂时重定向，由Location首部字段指定URL，搜索引起不响应更新。|
| 303 | 重定向状态，通常用作POST，PUT操作的返回结果。|
| 304 | 使用缓存的内容。|
| 305 | 永远重定向，资源被永远移动到Location指定的URL上，浏览器会进行重定向，搜索引起会更新URL连接。|
| 400 | 语法无效，导致服务器无法正确识别。|
| 401 | 客户端错误，状态码和WWW-Authenticate一起发送，要求身份认证。|
| 403 | 客户端错误，没有权限访问，不能再继续验证，即永久禁止。|
| 404 | 服务器无法找到资源。|
| 405 | 禁止使用方法。|
| 410 | 服务器资源丢失，并且永远丢失。|
| 500 | 服务器内部错误。|
| 501 | 请求方法服务器不支持。|
| 502 | 表示代理服务器从上游服务器接收的响应无效。|
| 503 | 服务器暂时处于请求处理状态。|
| 505 | 表示服务器不支持请求使用的HTTP版本。|

#### 原因短语

原因短语和数字状态码成对出现，为响应报文数字状态码提供了文本格式，使用短语描述状态，HTTP规范没有具体要求，开发过程中一般会使用见名知义的原因短语，用来给开发者和用户友好的提示。

CMD网站简单节选一些友好的原因短语：

| 状态码 | 原因短语 | 描述 |
|----|----|----|
|100| Continue | 连接状态目前为止可行的 |
|101| Switching Protocol| 协议切换 |
| 200| OK | 请求成功 |
| 201| Created| 创建成功 |
| 300| Multiple Choice | 重定向，有多个可能响应，可能存在优先选择 |
| 404|Not Found | 资源没找到 |
| 502| Bad Gateway | 服务器错误的响应 |

在Chrome开发过程中，可以使用开发者模式查看请求操作的状态码，可以通过Status Code 字段查看数字状态码和原因短语，下面是使用掘金首页查看的信息：
![掘金首页GET请求状态码](https://github.com/bojue/Blogs/blob/master/assets/reason_pharse.png)

#### 版本号

HTTP版本号使用HTTP/x.y的形式进行表述，类似于现在的NodeJs版本管理方案，x.y不是小数，x，y都是独立的数字，HTTP版本向下兼容。

HTTP版本升级伴随着性能优化或者特征扩展，以支持更多功能。

最早的版本是HTTP/0.9，仅支持GET方法，没有版本号，首部信息，媒体内容仅支持HTML文档，没有其他MIME类型，很快被HTTP/1.0取代。

目前常用的HTTP版本是HTTP1.1，相对于之前的版本HTTP1.1扩展了更多的首部以支持更多的功能，引入了性能优化措施，校正了结构缺陷，删除了不友好的特性。

#### HTTP首部

HTTP首部是添加在请求报文和相应报文的键值对列表，描述请求和相应的额外信息。

HTTP首部可以分为：
- 通用首部：可以使用在请求报文和响应报文中的首部字段
- 请求首部：仅使用在请求报文中的首部字段
- 响应首部：仅使用在响应报文中的首部字段
- 实体首部：描述实现信息的首部字段
- 扩展首部：自定义的首部字段，HTTP首部支持扩展首部

首部举例（[CDM 首部列表](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers)）

| 首部字段 | 首部类型 | 描述 |
|----|----|----|
|Accept: text/html | 通过首部 | 接收HTML文档，text/html是 MIME 类型的具体一种 |
|Accept: image/*| 通用首部 | 接收所以的图片MIME类型 |
|Connection: keep-alive| 通用首部 | Connection 决定当前的事务完成后，是否会关闭网络连接，keep-alive表示继续打开连接 |
|From: email地址 | 请求首部 |发送用户Eamil地址 |
|Content-Language| 实体首部/内容首部 | 描述用户语言，常用于多语言处理 |
| Set-Cookie: cookie-name = cookie-value | 响应首部 | 服务器向客户端发送cookie |


#### 参考
1. [HTTP报文详情](https://www.cnblogs.com/klguang/p/4618526.html)
2. [MDN: HTTP](https://developer.mozilla.org/zh-CN/docs/Web/HTTP)
3. [HTTP权威指南](https://book.douban.com/subject/10746113/)